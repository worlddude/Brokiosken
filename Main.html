<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brokiosken App</title>

  <style>
    /* --- Global styles --- */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(160deg, #e0f2fe 0%, #f1f5f9 100%);
    }

    /* --- Main wrapper --- */
    .app-wrap {
      width: 90%;
      max-width: 400px;
      height: 95vh;
      background: rgba(255,255,255,0.95);
      border-radius: 22px;
      overflow: hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px);
    }

    /* --- Login page --- */
    .container {
      padding: 40px 28px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
      justify-content: center;
      background: linear-gradient(180deg, #eff6ff 0%, #f8fafc 100%);
    }

    h1 {
      font-size: 32px;
      color: #1e3a8a;
      font-weight: 800;
      margin-bottom: 24px;
    }

    input {
      width: 100%;
      max-width: 320px;
      padding: 14px;
      margin-bottom: 12px;
      border: 1px solid #cbd5e1;
      border-radius: 12px;
      font-size: 16px;
      text-align: center;
      background: #f9fafb;
      transition: all 0.2s ease;
    }
    input:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
    }

    button {
      width: 100%;
      max-width: 320px;
      padding: 13px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background-color: #2563eb;
      color: #fff;
      font-weight: 600;
      margin-bottom: 10px;
      transition: all 0.2s;
    }
    button:hover { background-color: #1d4ed8; transform: translateY(-1px); }

    p#status {
      transition: opacity 0.4s;
      opacity: 0;
      font-size: 14px;
      font-weight: 500;
      margin-top: 12px;
    }

    /* --- Header --- */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      background: linear-gradient(90deg, #2563eb, #3b82f6);
      color: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .header h2 { margin: 0; font-size: 18px; font-weight: 600; }
    .header .right { display:flex; align-items:center; gap:12px; }
    .cart-btn img { filter: invert(100%); }

    /* --- Content --- */
    .content {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: #f1f5f9;
      animation: fadeIn 0.3s ease;
    }

    /* --- Product & offer cards --- */
    .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 14px; }

    .product-card, .offer-card {
      background: #fff;
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.15s ease, box-shadow 0.2s;
    }
    .product-card:hover, .offer-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }

    .product-card img, .offer-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 8px;
    }

    .product-info { text-align:center; flex:1; }
    .price { font-weight:700; color:#0f172a; }
    .buy-btn {
      padding:8px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      background:#06b6d4;
      color:white;
      font-weight:600;
      width:100%;
      transition:background 0.2s;
    }
    .buy-btn:hover { background:#0891b2; }

    /* --- Bottom navigation --- */
    .bottom-nav {
      display:flex;
      justify-content:space-around;
      background:#e0e7ff;
      padding:8px 0;
      width:100%;
      border-top:1px solid #cbd5e1;
    }
    .bottom-nav button {
      background:none;
      border:none;
      color:#475569;
      font-weight:500;
      font-size:12px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      transition:color 0.2s, transform 0.15s;
    }
    .bottom-nav button img { width:24px; height:24px; opacity:0.8; }
    .bottom-nav button.active { color:#2563eb; transform:scale(1.1); }
    .bottom-nav button.active img { opacity:1; filter:drop-shadow(0 0 3px #93c5fd); }

    /* --- Search box --- */
    .search-box { width:100%; display:flex; justify-content:center; margin-bottom:14px; }
    .search-box input {
      width:95%;
      padding:10px;
      border-radius:10px;
      border:1px solid #cbd5e1;
      text-align:center;
      background:#fff;
    }

    /* --- Cart --- */
    .cart-btn { position:relative; border:none; background:none; cursor:pointer; display:flex; align-items:center; }
    .cart-count {
      position:absolute; top:-6px; right:-6px;
      background:#ef4444; color:white; font-size:12px;
      padding:2px 6px; border-radius:999px;
    }
    .cart-drawer {
      position:fixed; right:12px; bottom:72px;
      width:320px; max-width:calc(100% - 40px);
      background:#fff; border-radius:16px;
      box-shadow:0 12px 40px rgba(0,0,0,0.2);
      overflow:hidden; z-index:60;
      display:none; flex-direction:column;
      animation:slideUp 0.25s ease-out;
    }
    .cart-header {
      padding:12px 14px; border-bottom:1px solid rgba(0,0,0,0.06);
      display:flex; justify-content:space-between; align-items:center;
      background:#f8fafc;
    }
    .cart-list {
      max-height:320px; overflow:auto; padding:10px;
      display:flex; flex-direction:column; gap:8px;
    }
    .cart-row { display:flex; gap:8px; align-items:center; }
    .cart-row img { width:44px; height:44px; object-fit:cover; border-radius:6px; }
    .cart-actions {
      padding:12px; border-top:1px solid rgba(0,0,0,0.06);
      display:flex; justify-content:space-between; align-items:center;
      background:#f8fafc;
    }
    .checkout-btn {
      padding:8px 12px; border-radius:8px; border:none; cursor:pointer;
      background:#10b981; color:white; font-weight:700;
      transition:background 0.2s;
    }
    .checkout-btn:hover { background:#059669; }

    /* --- Section headers --- */
    .section-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .section-row h3 { margin:0; color:#1e3a8a; font-weight:700; }

    /* --- Animations --- */
    @keyframes slideUp { from{transform:translateY(20px);opacity:0;} to{transform:translateY(0);opacity:1;} }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

    /* --- Responsive --- */
    @media (max-width:420px){ .cart-drawer{ right:8px; left:8px; width:auto; } }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div class="app-wrap" id="app">
    <div class="container" id="loginPage">
      <h1>Brokiosken</h1>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Adgangskode" />
      <button onclick="signupUser()">Opret bruger</button>
      <button onclick="loginUser()">Log ind</button>
      <p id="status"></p>
    </div>

    <!-- MAIN APP -->
    <div id="mainPage" style="display:none; height:100%; flex-direction:column;">
      <div class="header">
        <h2 id="pageTitle">Butik</h2>
        <div class="right">
          <button class="cart-btn" id="cartToggle" title="Vis kurv" onclick="toggleCart()">
            <img src="./icons/cart.png" alt="Kurv" style="width:24px;height:24px;" />
            <span class="cart-count" id="cartCount" style="display:none">0</span>
          </button>
        </div>
      </div>

      <div class="content" id="pageContent"></div>

      <div class="bottom-nav">
        <button data-section="news" onclick="showSection('news')">
          <img src="./icons/discount.png" alt="Tilbud" />
          <span>Nyheder</span>
        </button>
        <button data-section="store" onclick="showSection('store')">
          <img src="./icons/shop.png" alt="Butik" />
          <span>Butik</span>
        </button>
        <button data-section="profile" onclick="showSection('profile')">
          <img src="./icons/user.png" alt="Profil" />
          <span>Profil</span>
        </button>
      </div>

      <!-- CART DRAWER -->
      <div class="cart-drawer" id="cartDrawer">
        <div class="cart-header">
          <strong>Din kurv</strong>
          <button onclick="closeCart()" style="border:none;background:none;cursor:pointer;font-weight:700">âœ•</button>
        </div>
        <div class="cart-list" id="cartList"></div>
        <div class="cart-actions">
          <div><strong>Total:</strong> <span id="cartTotal">0 kr</span></div>
          <div><button class="checkout-btn" onclick="checkout()">KÃ¸b</button></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPT (logic unchanged) -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
    const supabase = createClient(
      'https://olfvimlmyqtadzkwiibg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9sZnZpbWxteXF0YWR6a3dpaWJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNDgyNTcsImV4cCI6MjA3NzcyNDI1N30.KgNwLHO7fDH1YCRb5cEc9Yo-mSNtae83B783o-0Hqr4'
    )

    /* === Full original JS logic retained === */
    const status=document.getElementById('status');
    const loginPage=document.getElementById('loginPage');
    const mainPage=document.getElementById('mainPage');
    const pageContent=document.getElementById('pageContent');
    const pageTitle=document.getElementById('pageTitle');
    const cartCountEl=document.getElementById('cartCount');
    const cartDrawer=document.getElementById('cartDrawer');

    function showMessage(text,success=true){status.textContent=text;status.style.color=success?'#1d4ed8':'#dc2626';status.style.opacity='1';setTimeout(()=>status.style.opacity='0',4000);}
    async function signupUser(){const email=document.getElementById('email').value.trim();const password=document.getElementById('password').value.trim();if(!email||!password)return showMessage('Udfyld email og adgangskode.',false);const{error}=await supabase.auth.signUp({email,password});if(error)showMessage(`Fejl: ${error.message}`,false);else showMessage('âœ… Bruger oprettet! Tjek din email for bekrÃ¦ftelse.',true);}
    async function loginUser(){const email=document.getElementById('email').value.trim();const password=document.getElementById('password').value.trim();if(!email||!password)return showMessage('Udfyld email og adgangskode.',false);const{data,error}=await supabase.auth.signInWithPassword({email,password});if(error){showMessage(`Fejl: ${error.message}`,false);}else{showMessage('âœ… Du er nu logget ind!',true);setTimeout(()=>{loginPage.style.display='none';mainPage.style.display='flex';showSection('store');},600);}}
    async function logoutUser(){await supabase.auth.signOut();mainPage.style.display='none';loginPage.style.display='flex';showMessage('Du er logget ud.',true);}

    function getCart(){try{return JSON.parse(localStorage.getItem('brokiosken_cart')||'[]')}catch(e){return[]}}
    function saveCart(cart){localStorage.setItem('brokiosken_cart',JSON.stringify(cart));renderCartCount();}
    function addToCart(product){const cart=getCart();const found=cart.find(i=>i.id===product.id);if(found)found.qty=(found.qty||1)+1;else cart.push(Object.assign({},product,{qty:1}));saveCart(cart);showMessage('âœ… TilfÃ¸jet til kurven',true);}
    function removeFromCart(productId){let cart=getCart().filter(i=>i.id!==productId);saveCart(cart);renderCart();}
    function renderCartCount(){const cart=getCart();const totalQty=cart.reduce((s,i)=>s+(i.qty||0),0);if(totalQty>0){cartCountEl.style.display='inline-block';cartCountEl.textContent=totalQty;}else{cartCountEl.style.display='none';}}
    function toggleCart(){if(cartDrawer.style.display==='flex')closeCart();else openCart();}
    function openCart(){renderCart();cartDrawer.style.display='flex';}
    function closeCart(){cartDrawer.style.display='none';}
    function renderCart(){const cartList=document.getElementById('cartList');const cart=getCart();cartList.innerHTML='';let total=0;cart.forEach(item=>{total+=(item.price||0)*(item.qty||1);const row=document.createElement('div');row.className='cart-row';row.innerHTML=`<img src="${item.image_url||'./icons/placeholder.png'}" alt="${item.name}" /><div style="flex:1;min-width:0"><div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${item.name}</div><div style="font-size:13px">${item.qty} Ã— ${item.price} kr</div></div><div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end"><button style="border:none;background:none;cursor:pointer;color:#ef4444;font-weight:700" onclick="removeFromCart('${item.id}')">Fjern</button></div>`;cartList.appendChild(row);});document.getElementById('cartTotal').textContent=`${total} kr`;renderCartCount();}
    function checkout(){const cart=getCart();if(!cart.length)return showMessage('Din kurv er tom',false);localStorage.removeItem('brokiosken_cart');renderCartCount();renderCart();showMessage('Tak! Din ordre er modtaget (demo).',true);closeCart();}
    async function resolveImageUrl(imageField){if(!imageField)return'./icons/placeholder.png';if(imageField.startsWith('http'))return imageField;try{const{data}=supabase.storage.from('product-images').getPublicUrl(imageField);if(data&&data.publicUrl)return data.publicUrl;}catch(e){console.warn('resolveImageUrl error',e);}return imageField;}
    async function fetchProducts(){const{data,error}=await supabase.from('products').select('id,name,price,image_url');if(error){console.error('Products fetch error',error);return{error,data:[]}}return{data:data||[],error:null}}
    async function fetchOffers(){const{data,error}=await supabase.from('offers').select('id,title,description,price,image_url');if(error||!data){return[{id:1,title:'ðŸŽ‰ 2x Kaffe To Go - kun 40 kr!',description:'',price:40},{id:2,title:'ðŸ¥ª Ny sandwich: Kylling & Bacon',description:'',price:45}]}return data;}
    function createProductCard(p){const card=document.createElement('div');card.className='product-card';const img=document.createElement('img');img.src=p.image_url||'./icons/placeholder.png';img.alt=p.name;const info=document.createElement('div');info.className='product-info';info.innerHTML=`<div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${p.name}</div><div style="color:#64748b;font-size:13px">Produkt-id: ${p.id}</div>`;const actions=document.createElement('div');actions.className='product-actions';const priceEl=document.createElement('div');priceEl.className='price';priceEl.textContent=`${p.price} kr`;const buyBtn=document.createElement('button');buyBtn.className='buy-btn';buyBtn.textContent='TilfÃ¸j';buyBtn.onclick=()=>addToCart({id:String(p.id),name:p.name,price:Number(p.price)||0,image_url:p.image_url});actions.appendChild(priceEl);actions.appendChild(buyBtn);card.appendChild(img);card.appendChild(info);card.appendChild(actions);return card;}
    function createOfferCard(o){const card=document.createElement('div');card.className='offer-card';const left=document.createElement('div');left.style.display='flex';left.style.gap='10px';left.style.alignItems='center';left.style.flex='1';left.style.minWidth='0';const img=document.createElement('img');img.src=o.image_url||'./icons/placeholder.png';img.alt=o.title;img.style.width='64px';img.style.height='64px';img.style.objectFit='cover';img.style.borderRadius='8px';const info=document.createElement('div');info.style.display='flex';info.style.flexDirection='column';info.style.gap='4px';info.style.minWidth='0';info.innerHTML=`<div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${o.title||o.name}</div><div style="color:#475569;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${o.description||''}</div>`;left.appendChild(img);left.appendChild(info);const right=document.createElement('div');right.style.display='flex';right.style.flexDirection='column';right.style.alignItems='flex-end';right.style.gap='8px';const priceEl=document.createElement('div');priceEl.className='price';priceEl.textContent=(o.price!==undefined&&o.price!==null)?`${Number(o.price)} kr`:'';const addBtn=document.createElement('button');addBtn.className='buy-btn';addBtn.textContent='TilfÃ¸j';addBtn.onclick=()=>addToCart({id:`offer-${o.id}`,name:o.title||o.name||`Tilbud ${o.id}`,price:Number(o.price)||0,image_url:o.image_url||null});right.appendChild(priceEl);right.appendChild(addBtn);card.appendChild(left);card.appendChild(right);return card;}
    async function showSection(section){pageContent.innerHTML='';document.querySelectorAll('.bottom-nav button').forEach(btn=>btn.classList.remove('active'));const activeBtn=document.querySelector(`.bottom-nav button[data-section="${section}"]`);if(activeBtn)activeBtn.classList.add('active');if(section==='store'){pageTitle.textContent='Butik';const searchWrap=document.createElement('div');searchWrap.className='search-box';searchWrap.innerHTML="<input type='text' id='productSearch' placeholder='SÃ¸g efter produkter...' />";pageContent.appendChild(searchWrap);const spinner=document.createElement('div');spinner.textContent='Henter produkterâ€¦';pageContent.appendChild(spinner);const{data:products,error}=await fetchProducts();pageContent.removeChild(spinner);if(!products||products.length===0){const noProducts=document.createElement('div');noProducts.style.padding='12px';noProducts.style.textAlign='center';noProducts.style.color='#475569';noProducts.textContent='Ingen produkter fundet.';pageContent.appendChild(noProducts);return}await Promise.all(products.map(async p=>{if(p.image_url&&!p.image_url.startsWith('http'))p.image_url=await resolveImageUrl(p.image_url);p.price=Number(p.price)||0;p.id=p.id!==undefined?p.id:Math.random().toString(36).slice(2,9);p.name=p.name||`Produkt ${p.id}`;}));const grid=document.createElement('div');grid.className='product-grid';products.forEach(p=>grid.appendChild(createProductCard(p)));pageContent.appendChild(grid);const searchInput=document.getElementById('productSearch');searchInput.addEventListener('input',e=>{const q=e.target.value.toLowerCase().trim();const filtered=products.filter(p=>(p.name||'').toLowerCase().includes(q));const newGrid=document.createElement('div');newGrid.className='product-grid';filtered.forEach(p=>newGrid.appendChild(createProductCard(p)));const oldGrid=pageContent.querySelector('.product-grid');if(oldGrid)oldGrid.replaceWith(newGrid);});}else if(section==='news'){pageTitle.textContent='Nyheder';const newsHeader=document.createElement('div');newsHeader.className='section-row';newsHeader.innerHTML='<h3>Nyheder</h3>';pageContent.appendChild(newsHeader);const newsContainer=document.createElement('div');newsContainer.style.display='flex';newsContainer.style.flexDirection='column';newsContainer.style.gap='10px';const exampleNews=[{id:'n1',title:'Ã…bningstider i dag',text:'Vi har Ã¥bent kl. 07-20'},{id:'n2',title:'Nye produkter',text:'Se vores nye sandwich i butikken'}];exampleNews.forEach(n=>{const card=document.createElement('div');card.className='offer-card';card.style.alignItems='flex-start';card.innerHTML=`<div style="font-weight:700">${n.title}</div><div style="color:#475569;font-size:13px">${n.text}</div>`;newsContainer.appendChild(card);});pageContent.appendChild(newsContainer);const offersHeader=document.createElement('div');offersHeader.className='section-row';offersHeader.innerHTML='<h3>Tilbud</h3>';pageContent.appendChild(offersHeader);const offers=await fetchOffers();const offersWrap=document.createElement('div');offersWrap.style.display='flex';offersWrap.style.flexDirection='column';offersWrap.style.gap='8px';if(!offers||offers.length===0){const noOffers=document.createElement('div');noOffers.style.padding='8px';noOffers.style.color='#475569';noOffers.textContent='Ingen tilbud fundet.';offersWrap.appendChild(noOffers);}else{await Promise.all(offers.map(async o=>{if(o.image_url&&!o.image_url.startsWith('http'))o.image_url=await resolveImageUrl(o.image_url);}));offers.forEach(o=>offersWrap.appendChild(createOfferCard(o)));}pageContent.appendChild(offersWrap);}else if(section==='profile'){pageTitle.textContent='Profil';const userResp=await supabase.auth.getUser();const user=userResp&&userResp.data?userResp.data.user:null;const email=(user&&user.email)||document.getElementById('email').value||'';const profileWrap=document.createElement('div');profileWrap.innerHTML=`<div style="padding:8px"><h3 style="color:#4a609e;">Din profil</h3><p><strong>Email:</strong> ${email}</p><p><strong>Loyalitetspoint:</strong> 120 point</p><button class="logout-btn" onclick="logoutUser()">Log ud</button></div>`;pageContent.appendChild(profileWrap);}}
    window.signupUser=signupUser;window.loginUser=loginUser;window.logoutUser=logoutUser;window.showSection=showSection;window.addToCart=addToCart;window.toggleCart=toggleCart;window.openCart=openCart;window.closeCart=closeCart;window.removeFromCart=removeFromCart;window.checkout=checkout;(function init(){renderCartCount()})();
  </script>
</body>
</html>
