<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brokiosken ‚Äì App</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    :root {
      --bg: #f1f5f9;
      --card: #fff;
      --brand1: #2563eb;
      --brand2: #3b82f6;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --accent1: #06b6d4;
      --accent2: #0ea5e9;
      --success1:#10b981;
      --success2:#22c55e;
      --shadow: 0 10px 40px rgba(0,0,0,.12);
      --radius: 22px;
    }
    body {
      margin: 0;
      font-family: "Inter", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh;
    }
    .app-wrap {
      width: 95%;
      max-width: 430px;
      height: 95vh;
      background: var(--card);
      border-radius: var(--radius);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    /* Header */
    .header {
      background: linear-gradient(90deg, var(--brand1), var(--brand2));
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      box-shadow: 0 2px 10px rgba(0,0,0,.12);
    }
    .header h2 { margin: 0; font-weight: 700; }

    /* Content */
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: var(--bg);
      animation: fadeIn .25s ease;
    }

    .section-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom: 8px;
    }
    .section-row h3 { margin:0; color: var(--brand1); font-weight:700; }

    .product-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(160px,1fr));
      gap:14px;
    }

    .product-card {
      background: var(--card);
      border-radius: 16px;
      padding: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,.08);
      display:flex;
      flex-direction:column;
      align-items:center;
      transition:transform .15s, box-shadow .2s;
    }
    .product-card:hover {
      transform:translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,.12);
    }
    .product-card img {
      width:100%;
      height:120px;
      object-fit:cover;
      border-radius:12px;
      margin-bottom:8px;
    }
    .product-info { text-align:center; flex:1; }
    .price { font-weight:700; margin:4px 0; }
    .buy-btn {
      border:none; border-radius:10px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color:white; font-weight:700;
      padding:8px 12px;
      width:100%;
      cursor:pointer;
      transition:transform .15s;
    }
    .buy-btn:hover { transform:translateY(-1px); }

    /* Bottom nav */
    .bottom-nav {
      display:flex;
      justify-content:space-around;
      background: #f8fafc;
      border-top:1px solid var(--border);
      padding:8px 0;
    }
    .bottom-nav button {
      background:none; border:none;
      font-size:12px; color: var(--muted);
      display:flex; flex-direction:column; align-items:center;
      cursor:pointer; gap:4px;
    }
    .bottom-nav button.active {
      color: var(--brand1);
      font-weight:700;
    }

    /* Animations */
    @keyframes fadeIn {
      from{opacity:0;transform:translateY(5px);}
      to{opacity:1;transform:translateY(0);}
    }

    /* Cart drawer */
    .cart-drawer {
      position:fixed;
      bottom:70px; right:12px;
      width:320px; max-width:calc(100% - 40px);
      background:var(--card);
      border-radius:16px;
      box-shadow:var(--shadow);
      display:none;
      flex-direction:column;
      animation:fadeIn .25s ease;
      overflow:hidden;
    }
    .cart-header, .cart-actions {
      padding:12px 14px;
      display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid var(--border);
    }
    .cart-actions {
      border-top:1px solid var(--border);
      border-bottom:none;
    }
    .cart-list {
      padding:10px;
      max-height:260px;
      overflow:auto;
      display:flex; flex-direction:column; gap:8px;
    }
    .cart-row { display:flex; align-items:center; gap:8px; }
    .cart-row img { width:44px; height:44px; border-radius:8px; object-fit:cover; }
    .checkout-btn {
      padding:8px 12px; border:none; border-radius:8px;
      background: linear-gradient(90deg, var(--success1), var(--success2));
      color:white; font-weight:700; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="app-wrap" id="app">
    <div class="header">
      <h2 id="pageTitle">Butik</h2>
      <button id="cartToggle" style="background:none;border:none;color:white;cursor:pointer;">üõí</button>
    </div>

    <div class="content" id="pageContent"></div>

    <div class="bottom-nav">
      <button data-section="news" onclick="showSection('news')">üì∞<span>Nyheder</span></button>
      <button data-section="store" class="active" onclick="showSection('store')">üè™<span>Butik</span></button>
      <button data-section="profile" onclick="showSection('profile')">üë§<span>Profil</span></button>
    </div>

    <!-- Cart drawer -->
    <div class="cart-drawer" id="cartDrawer">
      <div class="cart-header">
        <strong>Din kurv</strong>
        <button onclick="closeCart()" style="border:none;background:none;cursor:pointer;">‚úï</button>
      </div>
      <div class="cart-list" id="cartList"></div>
      <div class="cart-actions">
        <div><strong>Total:</strong> <span id="cartTotal">0 kr</span></div>
        <button class="checkout-btn" onclick="checkout()">K√∏b</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    /* === Supabase Setup === */
    const supabase = createClient(
      'https://olfvimlmyqtadzkwiibg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9sZnZpbWxteXF0YWR6a3dpaWJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNDgyNTcsImV4cCI6MjA3NzcyNDI1N30.KgNwLHO7fDH1YCRb5cEc9Yo-mSNtae83B783o-0Hqr4'
    );

    const LOGIN_PAGE_URL = "https://worlddude.github.io/Brokiosken/Login.html"; // üîπ Replace this with your login page address

    /* === Redirect if not logged in === */
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      window.location.href = LOGIN_PAGE_URL;
    }

    /* === Elements === */
    const pageContent = document.getElementById("pageContent");
    const cartDrawer = document.getElementById("cartDrawer");
    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");
    const cartToggle = document.getElementById("cartToggle");

    /* === Cart handling === */
    function getCart() { return JSON.parse(localStorage.getItem("cart") || "[]"); }
    function saveCart(c) { localStorage.setItem("cart", JSON.stringify(c)); renderCart(); }
    function addToCart(p) {
      const cart = getCart();
      const found = cart.find(i => i.id === p.id);
      if (found) found.qty++; else cart.push({...p, qty:1});
      saveCart(cart);
    }
    function renderCart() {
      const cart = getCart();
      cartList.innerHTML = "";
      let total = 0;
      cart.forEach(i=>{
        total += i.price * i.qty;
        const row = document.createElement("div");
        row.className="cart-row";
        row.innerHTML = \`
          <img src="\${i.image_url||'https://via.placeholder.com/60'}" />
          <div style="flex:1;">
            <div style="font-weight:700;">\${i.name}</div>
            <small>\${i.qty} √ó \${i.price} kr</small>
          </div>
          <button onclick="removeFromCart('\${i.id}')" style="border:none;background:none;color:red;cursor:pointer;">üóëÔ∏è</button>
        \`;
        cartList.appendChild(row);
      });
      cartTotal.textContent = total + " kr";
    }
    window.removeFromCart = (id)=>{
      const cart = getCart().filter(i=>i.id!==id);
      saveCart(cart);
    };
    window.checkout = ()=>{
      alert("Tak for dit k√∏b! (demo)");
      localStorage.removeItem("cart");
      renderCart();
    };
    window.closeCart = ()=>cartDrawer.style.display="none";
    cartToggle.onclick = ()=>cartDrawer.style.display = cartDrawer.style.display==="flex" ? "none":"flex";

    /* === Pages === */
    async function showSection(section) {
      document.querySelectorAll(".bottom-nav button").forEach(b=>b.classList.remove("active"));
      document.querySelector(\`[data-section="\${section}"]\`).classList.add("active");
      pageContent.innerHTML = "";

      if(section==="store"){
        document.getElementById("pageTitle").textContent="Butik";
        const { data: products } = await supabase.from("products").select("id,name,price,image_url");
        const grid = document.createElement("div"); grid.className="product-grid";
        (products||[]).forEach(p=>{
          const card=document.createElement("div"); card.className="product-card";
          card.innerHTML=\`
            <img src="\${p.image_url||'https://via.placeholder.com/150'}" alt="\${p.name}">
            <div class="product-info">
              <div style="font-weight:700;">\${p.name}</div>
              <div class="price">\${p.price} kr</div>
            </div>
            <button class="buy-btn" onclick='addToCart(\${JSON.stringify(p)})'>Tilf√∏j</button>
          \`;
          grid.appendChild(card);
        });
        pageContent.appendChild(grid);
      }

      if(section==="news"){
        document.getElementById("pageTitle").textContent="Nyheder";
        pageContent.innerHTML="<h3>Nyheder</h3><p>Ingen nyheder i √∏jeblikket.</p>";
      }

      if(section==="profile"){
        document.getElementById("pageTitle").textContent="Profil";
        const { data: userData } = await supabase.auth.getUser();
        pageContent.innerHTML = \`
          <h3>Profil</h3>
          <p><strong>Email:</strong> \${userData.user.email}</p>
          <button onclick="logoutUser()" style="padding:10px 12px;border:none;border-radius:8px;background:#ef4444;color:white;cursor:pointer;">Log ud</button>
        \`;
      }
    }

    async function logoutUser() {
      await supabase.auth.signOut();
      window.location.href = LOGIN_PAGE_URL;
    }

    window.showSection = showSection;
    showSection("store");
    renderCart();
  </script>
</body>
</html>
